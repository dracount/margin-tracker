# Production Docker Compose for Oracle Cloud
# Usage: docker compose -f docker-compose.prod.yml up -d --build

services:
  # PocketBase backend
  pocketbase:
    image: adrianmusante/pocketbase:latest
    container_name: pb_margins
    restart: unless-stopped
    volumes:
      - pocketbase_data:/pocketbase

  # React frontend
  frontend:
    build:
      context: .
      args:
        # Points frontend to PocketBase via Caddy proxy
        VITE_PB_URL: /api
    container_name: margin_frontend
    restart: unless-stopped

  # Caddy reverse proxy
  caddy:
    image: caddy:alpine
    container_name: margin_caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile.prod:/etc/caddy/Caddyfile
      - caddy_data:/data
    depends_on:
      - pocketbase
      - frontend

volumes:
  pocketbase_data:
  caddy_data:
