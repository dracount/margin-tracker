Here is a comprehensive **Product Requirement Document (PRD) / Implementation Sheet**. This is structured to be handed directly to a development team or used as a project roadmap.

---

# Project: Production Dashboard â€“ "Worksheet Mode" Refactor
**Objective:** Transform the current reporting dashboard into a high-density, operational workflow tool similar to a spreadsheet.
**Key Metrics:** Reduce clicks-to-edit by 80%, increase visible data density by 100%, and improve outlier detection.

---

## 1. Feature: Focus Mode (The Layout Strategy)
*Replaces the standard "Collapsible Header" concept with a dedicated work state.*

### A. The Toggle
*   **Location:** Top right of the table container (Icon: "Expand" or "Focus").
*   **Keyboard Shortcut:** `Shift + F`.
*   **State Persistence:** Save state to `localStorage`. If a user leaves in Focus Mode, they return in Focus Mode.

### B. View States
| Element | Default (Dashboard Mode) | Focus Mode (Worksheet Mode) |
| :--- | :--- | :--- |
| **KPI Cards** | Full block (200px height) | **Ticker Tape:** Single sticky top bar (30px). Format: `Rev: 25M | Prof: 17M | Margin: 68%` |
| **Chart** | Visible | **Hidden** |
| **Table Height** | Fixed / Scrollable within window | **Maximized:** `calc(100vh - 50px)` |
| **Row Density** | Standard (48px height) | **Compact** (32px height) |
| **Columns** | All columns visible | **Trimmed:** Hide static columns (e.g., Factory, Fabric) via user preference. |

---

## 2. Feature: Inline Editing (The "Excel Factor")
*Goal: Frictionless data manipulation.*

### A. Interaction Model
*   **Click-to-Edit:** Clicking a cell converts it to an input field immediately. No "Edit" icon required.
*   **Save on Blur:** Clicking away triggers the save.
*   **Optimistic UI:** The UI updates the number *instantly*. The API call happens in the background. If the API fails, revert the number and show a "Retry" toast notification.

### B. Keyboard Navigation (Accessibility)
*   `Tab`: Moves focus to the next cell to the right (saves current cell).
*   `Shift + Tab`: Moves focus left.
*   `Arrow Keys`: Navigate up/down/left/right through the grid.
*   `Enter`: Confirms edit and moves selection down one row.

### C. Bulk Actions
*   **Selection:** Add a checkbox column to the far left.
*   **Shift-Select:** Click row 1, hold Shift, click row 10 (selects all 10).
*   **Action Bar:** When rows are selected, a floating bottom bar appears: "Update Factory," "Bulk Status Change," "Export Selected."

---

## 3. Feature: Visual Intelligence & "Glanceability"
*Goal: Help the eye spot outliers without reading every number.*

### A. Status Pillars (Left Border)
*   Replace full-row background colors (which reduce readability) with a **4px colored bar** on the far left of the row.
    *   ðŸ”´ Red: Margin < 15%
    *   ðŸŸ  Orange: Margin 15-22%
    *   ðŸŸ¢ Green: Margin > 30%

### B. Micro-Charts (Sparklines)
*   **Column:** "Total Units" or "Performance".
*   **Implementation:** A small gray horizontal bar inside the cell behind the number, representing the value relative to the dataset max.

### C. Interactive Chart Filtering
*   **Action:** Clicking the "Red Bar" (Below Target) in the header chart.
*   **Result:** The table instantly filters to show **only** the 3 items that are below target.
*   **Indicator:** A filter chip appears: `[x] Status: Critical`.

---

## 4. Feature: Navigation & Context
*Goal: Manage wide and deep data.*

### A. Sticky Elements
*   **Sticky Header:** Table column headers remain fixed at the top during vertical scroll.
*   **Sticky Columns:** "Style #" and "Description" remain fixed to the left during horizontal scroll.

### B. The Context Drawer (Slide-Over)
*   **Trigger:** Clicking the `Style #` link.
*   **Action:** Opens a panel sliding in from the right (covering 30% of screen).
*   **Content:**
    *   Full "Fabric/Trim" details.
    *   Production history / Change Log.
    *   Comment threads.
*   **Benefit:** The user never leaves the main table context.

---

## 5. Technical Specifications (For Developers)

### Frontend Requirements
1.  **Virtualization:** Use a library like `react-window` or `tanstack-virtual`.
    *   *Why:* To render 1,000+ rows smoothly without DOM lag.
2.  **State Management:**
    *   Must handle "Dirty State" (unsaved changes) if the user tries to close the tab.
    *   Undo/Redo stack (Ctrl+Z support) for the last 5 actions is a "Nice to Have" for Phase 2.
3.  **Validation:**
    *
This feature spec is a solid starting point, but according to our **ZMA (Zero-Maintenance Asset)** and **Choice Architecture** standards, it needs to be "re-shuffled." 

Currently, your `free_tier` is too powerful (giving away all 50 states for free), and your `premium_tier` is a disorganized bucket. To maximize sales and hit the **$24.99 Target**, we need to map these features to the **Value Ladder.**

Here is the enhanced ZMA Feature Specification:

---

### Revised ZMA Feature Spec: `tax_calculator_2025`

#### 1. Tier: FREE (The "Aha!" Hook)
*Goal: Provide immediate, high-quality "Aha!" moments without requiring a payment or internet.*

*   **Federal Tax Engine (F001):** Full 2025 bracket support.
*   **Standard Deduction (F002):** Automated for all filing statuses.
*   **Visual Bracket Breakdown (F003):** (Moved from Gap) Educational visualization of how every dollar is taxed. **This is your "Wow" factor.**
*   **Single State Preview (F004):** Allow the user to select **one** home state to calculate. (Gives them the "Proof of Concept").
*   **Copy Result (F005):** Basic utility.

#### 2. Tier: DECOY / PRO BASIC ($4.99 - "The Homeowner")
*Goal: Remove the first layer of friction for users with slightly complex personal taxes.*

*   **Itemized Deductions (P001):** Basic support for Mortgage Interest and Charitable Donations.
*   **PDF Basic Export (P002):** A simple, clean summary of the federal/single-state result.
*   **Ad-Free Experience (P003):** (Implicit in ZMA) But explicitly marketed here.

#### 3. Tier: TARGET / EXPERT ($24.99 - "The Nomad & Professional")
*Goal: The primary revenue driver. Targets high-value users who save hours by using this.*

*   **50-State Unlock (P004):** (Moved from Free) Access to every state tax law for 2025. Crucial for nomads/remote workers.
*   **Scenario Comparison (P005):** Side-by-side: "Married Joint vs. Separate." This is "Advisory" logic.
*   **Self-Employment Engine (P006):** 1099/Freelancer tax and SE tax calculations.
*   **Tax Credits Module (P007):** Child Tax Credit, EITC, and Education credits.
*   **Professional PDF Report (P008):** Branded, detailed report suitable for sending to an accountant.

#### 4. Tier: ANCHOR / CPA PACK ($49.99 - "The Small Business/Advisor")
*Goal: Create a high price floor to make the $24.99 Expert tier look like a bargain.*

*   **Multi-Profile Vault (P009):** Save, name, and manage up to 50 different tax profiles (Family members or Clients).
*   **Audit Risk Indicator (P010):** Flag high-risk deduction ratios based on 2025 heuristics.
*   **Unlimited Calculation History (P011):** Local database of every calculation ever performed.

---

### Structural Changes for "Zero-Maintenance"
To ensure you never have to touch this app again:

1.  **Hard-Coded Tables:**
    *   The `federal_tax_calculation` and `state_tax_calculation` must **not** call an API. 
    *   They must read from a local `tax_data_2025.json` bundled in the app.
2.  **State Logic Gating:**
    *   In the code, the `state_manager` should check the `entitlement`:
        *   `if (free) { allowOnly(selected_state_id); }`
        *   `if (expert) { allowAll(); }`
3.  **Local Persistence:**
    *   `Multi-Profile Vault` uses a local SQLite table. No "Cloud Login" allowed. This prevents server costs and maintenance.

### Why this results in "Most Sales":
*   **The Free Tier** is better than the competition because it has the **Visual Breakdown** (educational value).
*   **The $4.99 Decoy** exists only to make people realize they have "Itemized Deductions" and should probably just get the **$24.99 Expert** version.
*   **The $24.99 Target** is where 70% of your revenue will come from. By gating **"All 50 States"** here, you capture the high-intent "Tax Season" traffic.
*   **The $49.99 Anchor** ensures that when a user sees $24.99, they don't think "expensive," they think "half price."

**Does this mapping look correct for your "ZMA" Factory? If yes, I will trigger the Architect to generate the technical file schema for the 50-state JSON.**